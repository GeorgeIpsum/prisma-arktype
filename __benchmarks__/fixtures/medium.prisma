// Medium Schema - Current Scale Performance Testing
// 25 models, 5 enums, ~200 fields
// Target: <500ms generation time
// Output: ~200 files, ~800 KB

datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

generator prisma_arktype {
  provider = "node ../../dist/index.js"
  output   = "../../__benchmarks__/reports/.generated/medium"
}

// Enums
enum UserRole {
  ADMIN
  USER
  MODERATOR
  GUEST
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentMethod {
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  BANK_TRANSFER
  CRYPTO
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ContentType {
  TEXT
  IMAGE
  VIDEO
  AUDIO
  DOCUMENT
}

// User Management
model User {
  id           String    @id @default(cuid())
  email        String    @unique
  username     String    @unique
  firstName    String
  lastName     String
  passwordHash String
  role         UserRole  @default(USER)
  isActive     Boolean   @default(true)
  lastLoginAt  DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  profile      UserProfile?
  posts        Post[]
  comments     Comment[]
  orders       Order[]
  payments     Payment[]
  notifications Notification[]
  sessions     Session[]

  @@index([email])
  @@index([username])
}

model UserProfile {
  id        String   @id @default(cuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  bio       String?  @db.Text
  avatarUrl String?
  website   String?
  location  String?
  birthDate DateTime?
  phone     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Session {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([token])
}

// Content Management
model Post {
  id          String      @id @default(cuid())
  title       String
  slug        String      @unique
  content     String      @db.Text
  excerpt     String?
  published   Boolean     @default(false)
  authorId    String
  author      User        @relation(fields: [authorId], references: [id])
  categoryId  String?
  category    Category?   @relation(fields: [categoryId], references: [id])
  views       Int         @default(0)
  likes       Int         @default(0)
  publishedAt DateTime?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  comments Comment[]
  tags     PostTag[]
  media    Media[]

  @@index([authorId])
  @@index([categoryId])
  @@index([slug])
}

model Comment {
  id        String   @id @default(cuid())
  content   String   @db.Text
  postId    String
  post      Post     @relation(fields: [postId], references: [id])
  authorId  String
  author    User     @relation(fields: [authorId], references: [id])
  parentId  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([postId])
  @@index([authorId])
}

model Category {
  id          String @id @default(cuid())
  name        String @unique
  slug        String @unique
  description String?
  parentId    String?

  posts Post[]

  @@index([slug])
}

model Tag {
  id    String @id @default(cuid())
  name  String @unique
  slug  String @unique
  posts PostTag[]

  @@index([slug])
}

model PostTag {
  postId String
  post   Post   @relation(fields: [postId], references: [id])
  tagId  String
  tag    Tag    @relation(fields: [tagId], references: [id])

  @@id([postId, tagId])
}

model Media {
  id          String      @id @default(cuid())
  filename    String
  url         String
  mimeType    String
  size        Int
  contentType ContentType
  postId      String?
  post        Post?       @relation(fields: [postId], references: [id])
  createdAt   DateTime    @default(now())

  @@index([postId])
}

// E-commerce
model Product {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String   @db.Text
  price       Decimal  @db.Decimal(10, 2)
  salePrice   Decimal? @db.Decimal(10, 2)
  sku         String   @unique
  stock       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  orderItems  OrderItem[]
  reviews     Review[]
  categoryProducts CategoryProduct[]

  @@index([slug])
  @@index([sku])
}

model ProductCategory {
  id          String @id @default(cuid())
  name        String @unique
  slug        String @unique
  description String?

  products CategoryProduct[]

  @@index([slug])
}

model CategoryProduct {
  productId  String
  product    Product         @relation(fields: [productId], references: [id])
  categoryId String
  category   ProductCategory @relation(fields: [categoryId], references: [id])

  @@id([productId, categoryId])
}

model Order {
  id          String      @id @default(cuid())
  orderNumber String      @unique
  userId      String
  user        User        @relation(fields: [userId], references: [id])
  status      OrderStatus @default(PENDING)
  total       Decimal     @db.Decimal(10, 2)
  subtotal    Decimal     @db.Decimal(10, 2)
  tax         Decimal     @db.Decimal(10, 2)
  shipping    Decimal     @db.Decimal(10, 2)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  items    OrderItem[]
  payments Payment[]
  shipment Shipment?

  @@index([userId])
  @@index([orderNumber])
}

model OrderItem {
  id        String  @id @default(cuid())
  orderId   String
  order     Order   @relation(fields: [orderId], references: [id])
  productId String
  product   Product @relation(fields: [productId], references: [id])
  quantity  Int
  price     Decimal @db.Decimal(10, 2)

  @@index([orderId])
  @@index([productId])
}

model Payment {
  id            String        @id @default(cuid())
  orderId       String
  order         Order         @relation(fields: [orderId], references: [id])
  userId        String
  user          User          @relation(fields: [userId], references: [id])
  amount        Decimal       @db.Decimal(10, 2)
  method        PaymentMethod
  transactionId String        @unique
  status        String
  createdAt     DateTime      @default(now())

  @@index([orderId])
  @@index([userId])
  @@index([transactionId])
}

model Shipment {
  id            String   @id @default(cuid())
  orderId       String   @unique
  order         Order    @relation(fields: [orderId], references: [id])
  trackingNumber String   @unique
  carrier       String
  shippedAt     DateTime?
  deliveredAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([trackingNumber])
}

model Review {
  id        String   @id @default(cuid())
  productId String
  product   Product  @relation(fields: [productId], references: [id])
  rating    Int
  title     String
  content   String   @db.Text
  authorName String
  authorEmail String
  isVerified Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([productId])
}

// System
model Notification {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  title     String
  message   String   @db.Text
  type      String
  isRead    Boolean  @default(false)
  priority  Priority @default(MEDIUM)
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([isRead])
}

model AuditLog {
  id         String   @id @default(cuid())
  action     String
  entityType String
  entityId   String
  userId     String?
  changes    Json
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([entityType, entityId])
  @@index([userId])
}

model Config {
  key       String   @id
  value     String   @db.Text
  category  String
  isPublic  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([category])
}
